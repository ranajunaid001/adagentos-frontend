<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AdAgentOS - AI Performance Analyst</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif; }
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-thumb { background: #e5e5e5; border-radius: 3px; }
    .sql-code {
      background: #1e1e1e;
      color: #d4d4d4;
      padding: 12px;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      overflow-x: auto;
      white-space: pre;
    }
    .fade-in {
      animation: fadeIn 0.6s ease-out;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .example-card {
      transition: all 0.2s ease;
      cursor: pointer;
    }
    .example-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
    }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState, useRef, useEffect } = React;

    function formatText(text) {
      return text
        .replace(/### (.*?)$/gm, '<h3 class="font-semibold text-lg mb-2 mt-4">$1</h3>')
        .replace(/\*\*(.*?)\*\*/g, '<strong class="font-semibold">$1</strong>')
        .replace(/â€¢ /g, '')
        .replace(/- (.*?)$/gm, '<div class="ml-4 mb-1">â†’ $1</div>')
        .replace(/^\d+\. (.*?)$/gm, '<div class="ml-4 mb-2 font-medium">$&</div>')
        .replace(/\n/g, '<br/>');
    }

    function CollapsibleSQL({ sql }) {
      const [isExpanded, setIsExpanded] = useState(false);

      if (!sql) return null;

      return (
        <div className="mb-3 mt-2">
          <button
            onClick={() => setIsExpanded(!isExpanded)}
            className="flex items-center gap-2 text-sm text-gray-600 hover:text-gray-900 transition-colors"
          >
            <span>{isExpanded ? 'â–¼' : 'â–¶'}</span>
            <span className="font-medium">View SQL Query</span>
          </button>
          {isExpanded && (
            <div className="mt-2 sql-code">
              {sql}
            </div>
          )}
        </div>
      );
    }

    // Welcome State Component
    function WelcomeState({ onExampleClick }) {
      const examples = [
        { icon: 'ðŸ“Š', title: 'Analyze Performance', desc: 'ROAS, conversions, revenue metrics', question: 'Which platform has the best ROAS?' },
        { icon: 'ðŸ’°', title: 'Budget Strategy', desc: 'Optimize spend allocation', question: 'Where should I invest more budget?' },
        { icon: 'ðŸ“¹', title: 'Video Metrics', desc: 'Completion rates, engagement', question: 'Show me video completion rates by platform' },
        { icon: 'ðŸŽ¯', title: 'Compare Segments', desc: 'Platforms, regions, demographics', question: 'Compare performance across all regions' }
      ];

      return React.createElement('div', { className: 'flex-1 flex items-center justify-center p-8 fade-in' },
        React.createElement('div', { className: 'max-w-2xl w-full text-center' },
          // Header
          React.createElement('div', { className: 'mb-8' },
            React.createElement('h1', { className: 'text-3xl font-light text-gray-900 mb-2' }, 'AdAgentOS'),
            React.createElement('p', { className: 'text-gray-600' }, 'AI Performance Analyst')
          ),
          
          // Connected Platforms
          React.createElement('div', { className: 'mb-12' },
            React.createElement('p', { className: 'text-sm text-gray-500 mb-4' }, 'Connected to your ad accounts'),
            React.createElement('div', { className: 'flex flex-wrap justify-center gap-2' },
              ['TikTok', 'Facebook', 'YouTube', 'Instagram', 'Snapchat'].map((platform, i) =>
                React.createElement('span', { 
                  key: platform,
                  className: 'px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm',
                  style: { animation: `fadeIn 0.6s ease-out ${0.1 * (i + 1)}s both` }
                }, platform)
              )
            )
          ),
          
          // Question Prompt
          React.createElement('h2', { className: 'text-xl font-light text-gray-900 mb-8' }, 'What can I help you with?'),
          
          // Example Categories
          React.createElement('div', { className: 'grid grid-cols-2 gap-4 mb-8' },
            examples.map(example =>
              React.createElement('div', { 
                key: example.title,
                className: 'example-card bg-gray-50 rounded-xl p-6 text-left hover:bg-gray-100',
                onClick: () => onExampleClick(example.question)
              },
                React.createElement('div', { className: 'text-2xl mb-2' }, example.icon),
                React.createElement('h3', { className: 'font-medium text-gray-900 mb-1' }, example.title),
                React.createElement('p', { className: 'text-sm text-gray-600' }, example.desc)
              )
            )
          ),
          
          // Example Question
          React.createElement('div', { className: 'text-gray-500 text-sm' },
            React.createElement('span', { className: 'inline-block px-3 py-1 bg-gray-100 rounded-lg' },
              'Example: "Which platform has the best ROAS?"'
            )
          )
        )
      );
    }

function DynamicVisualization({ visualization }) {
  if (!visualization) return null;
  
  // DEEP DIVE VISUALIZATION
  if (visualization.type === 'deep_dive') {
    const platform = visualization.platform;
    const metrics = visualization.data;
    
    return React.createElement('div', { className: 'mt-4 space-y-6' },
      // Platform Header
      React.createElement('h2', { className: 'text-xl font-semibold mb-4' }, 
        `${platform} Performance Dashboard`
      ),
      
      // Key Metrics Grid
      React.createElement('div', { className: 'grid grid-cols-2 md:grid-cols-4 gap-4 mb-6' },
        // ROAS Card
        React.createElement('div', { className: 'bg-blue-50 rounded-lg p-4 border border-blue-200' },
          React.createElement('div', { className: 'text-xs text-gray-600' }, 'ROAS'),
          React.createElement('div', { className: 'text-2xl font-bold text-blue-600' }, 
            `${metrics.roas || 0}x`
          )
        ),
        
        // CTR Card
        React.createElement('div', { className: 'bg-green-50 rounded-lg p-4 border border-green-200' },
          React.createElement('div', { className: 'text-xs text-gray-600' }, 'CTR'),
          React.createElement('div', { className: 'text-2xl font-bold text-green-600' }, 
            `${metrics.ctr || 0}%`
          )
        ),
        
        // CPM Card
        React.createElement('div', { className: 'bg-purple-50 rounded-lg p-4 border border-purple-200' },
          React.createElement('div', { className: 'text-xs text-gray-600' }, 'CPM'),
          React.createElement('div', { className: 'text-2xl font-bold text-purple-600' }, 
            `$${metrics.cpm || 0}`
          )
        ),
        
        // CPA Card
        React.createElement('div', { className: 'bg-yellow-50 rounded-lg p-4 border border-yellow-200' },
          React.createElement('div', { className: 'text-xs text-gray-600' }, 'CPA'),
          React.createElement('div', { className: 'text-2xl font-bold text-yellow-600' }, 
            `$${metrics.cpa || 0}`
          )
        )
      ),
      
      // Financial Summary
      React.createElement('div', { className: 'bg-white rounded-lg border border-gray-200 p-6' },
        React.createElement('h3', { className: 'text-sm font-medium mb-4' }, 'Financial Summary'),
        React.createElement('div', { className: 'grid grid-cols-3 gap-4' },
          React.createElement('div', null,
            React.createElement('div', { className: 'text-xs text-gray-500' }, 'Spend'),
            React.createElement('div', { className: 'text-lg font-semibold' }, 
              `$${((metrics.spend || 0)/1000).toFixed(0)}k`
            )
          ),
          React.createElement('div', null,
            React.createElement('div', { className: 'text-xs text-gray-500' }, 'Revenue'),
            React.createElement('div', { className: 'text-lg font-semibold text-green-600' }, 
              `$${((metrics.revenue || 0)/1000).toFixed(0)}k`
            )
          ),
          React.createElement('div', null,
            React.createElement('div', { className: 'text-xs text-gray-500' }, 'Profit'),
            React.createElement('div', { className: 'text-lg font-semibold text-blue-600' }, 
              `$${(((metrics.revenue || 0) - (metrics.spend || 0))/1000).toFixed(0)}k`
            )
          )
        )
      ),
      
      // Engagement Metrics
      React.createElement('div', { className: 'bg-white rounded-lg border border-gray-200 p-6' },
        React.createElement('h3', { className: 'text-sm font-medium mb-4' }, 'Engagement Metrics'),
        React.createElement('div', { className: 'space-y-3' },
          React.createElement('div', { className: 'flex justify-between' },
            React.createElement('span', { className: 'text-sm text-gray-600' }, 'Impressions'),
            React.createElement('span', { className: 'font-medium' }, 
              `${((metrics.impressions || 0)/1000000).toFixed(1)}M`
            )
          ),
          React.createElement('div', { className: 'flex justify-between' },
            React.createElement('span', { className: 'text-sm text-gray-600' }, 'Clicks'),
            React.createElement('span', { className: 'font-medium' }, 
              `${((metrics.clicks || 0)/1000).toFixed(0)}k`
            )
          ),
          React.createElement('div', { className: 'flex justify-between' },
            React.createElement('span', { className: 'text-sm text-gray-600' }, 'Conversions'),
            React.createElement('span', { className: 'font-medium' }, 
              `${((metrics.conversions || 0)/1000).toFixed(1)}k`
            )
          ),
          React.createElement('div', { className: 'flex justify-between' },
            React.createElement('span', { className: 'text-sm text-gray-600' }, 'Video Completion Rate'),
            React.createElement('span', { className: 'font-medium' }, 
              `${metrics.video_completion_rate || metrics.completionRate || 0}%`
            )
          )
        )
      )
    );
  }

  const { dimension, data, requestedMetrics = ['financial'], goal } = visualization;
    // Override metrics based on goal
  // Override metrics based on goal ONLY if not comprehensive
  let metricsToShow = requestedMetrics;
  if (requestedMetrics[0] !== 'comprehensive') {
    if (goal === 'AWARENESS') {
      metricsToShow = ['impressions', 'cpm'];
    } else if (goal === 'ENGAGEMENT') {
      metricsToShow = ['ctr'];
    } else if (goal === 'CONVERSION') {
      metricsToShow = ['financial'];
    }
  }
  const primaryMetric = metricsToShow[0];
  
  const items = Object.keys(data);
  
  // FIX: Handle null dimension safely
  const dimensionLabel = dimension === 'age_group' ? 'Age Group' : 
                       dimension === 'gender' ? 'Gender' :
                       dimension ? dimension.charAt(0).toUpperCase() + dimension.slice(1) : 'Category';

  // Platform colors
  const platformColors = {
    TikTok: { bg: '#000000', text: '#FFFFFF' },
    Instagram: { bg: '#E4405F', text: '#FFFFFF' },
    Facebook: { bg: '#1877F2', text: '#FFFFFF' },
    YouTube: { bg: '#FF0000', text: '#FFFFFF' },
    Snapchat: { bg: '#FFFC00', text: '#000000' }
  };

  const getColor = (item) => {
    if (dimension === 'platform' && platformColors[item]) {
      return platformColors[item];
    }
    const colors = ['#3B82F6', '#10B981', '#F59E0B', '#EF4444', '#8B5CF6', '#EC4899'];
    const index = items.indexOf(item) % colors.length;
    return { bg: colors[index], text: '#FFFFFF' };
  };

  // COMPREHENSIVE COMPARISON VISUALIZATION
  if (primaryMetric === 'comprehensive') {
    // Get all metrics for comprehensive view
    const totalSpend = Object.values(data).reduce((sum, d) => sum + (d.spend || 0), 0);
    const totalRevenue = Object.values(data).reduce((sum, d) => sum + (d.revenue || 0), 0);
    const totalImpressions = Object.values(data).reduce((sum, d) => sum + (d.impressions || 0), 0);
    const totalClicks = Object.values(data).reduce((sum, d) => sum + (d.clicks || 0), 0);
    
    return React.createElement('div', { className: 'mt-4 space-y-6' },
      // Overall Summary Cards
      React.createElement('div', { className: 'grid grid-cols-2 md:grid-cols-4 gap-3 mb-6' },
        React.createElement('div', { className: 'bg-blue-50 rounded-lg p-3 border border-blue-200' },
          React.createElement('div', { className: 'text-xs text-gray-600' }, 'Combined ROAS'),
          React.createElement('div', { className: 'text-xl font-bold text-blue-600' }, 
            totalSpend > 0 ? ((totalRevenue / totalSpend).toFixed(1) + 'x') : '0x'
          )
        ),
        React.createElement('div', { className: 'bg-green-50 rounded-lg p-3 border border-green-200' },
          React.createElement('div', { className: 'text-xs text-gray-600' }, 'Total Revenue'),
          React.createElement('div', { className: 'text-xl font-bold text-green-600' }, 
            '$' + (totalRevenue/1000).toFixed(0) + 'k'
          )
        ),
        React.createElement('div', { className: 'bg-purple-50 rounded-lg p-3 border border-purple-200' },
          React.createElement('div', { className: 'text-xs text-gray-600' }, 'Combined CTR'),
          React.createElement('div', { className: 'text-xl font-bold text-purple-600' }, 
            totalImpressions > 0 ? ((totalClicks / totalImpressions * 100).toFixed(2) + '%') : '0%'
          )
        ),
        React.createElement('div', { className: 'bg-yellow-50 rounded-lg p-3 border border-yellow-200' },
          React.createElement('div', { className: 'text-xs text-gray-600' }, 'Total Impressions'),
          React.createElement('div', { className: 'text-xl font-bold text-yellow-600' }, 
            (totalImpressions/1000000).toFixed(0) + 'M'
          )
        )
      ),
      
      // Detailed Comparison Table
      React.createElement('div', { className: 'bg-white rounded-lg border border-gray-200 p-4' },
        React.createElement('h3', { className: 'text-sm font-medium mb-4' }, 'Platform Comparison'),
        React.createElement('div', { className: 'space-y-6' },
          items.map(item => {
            const colors = getColor(item);
            const d = data[item];
            
            return React.createElement('div', { key: item, className: 'border-b border-gray-100 pb-4 last:border-0' },
              // Platform name
              React.createElement('div', { 
                className: 'font-medium mb-3',
                style: { color: colors.bg }
              }, item),
              
              // Metrics grid for this platform
              React.createElement('div', { className: 'grid grid-cols-2 md:grid-cols-4 gap-4 text-sm' },
                React.createElement('div', null,
                  React.createElement('div', { className: 'text-gray-500' }, 'ROAS'),
                  React.createElement('div', { className: 'font-semibold' }, (d.roas || 0) + 'x')
                ),
                React.createElement('div', null,
                  React.createElement('div', { className: 'text-gray-500' }, 'Revenue'),
                  React.createElement('div', { className: 'font-semibold' }, '$' + ((d.revenue || 0)/1000).toFixed(0) + 'k')
                ),
                React.createElement('div', null,
                  React.createElement('div', { className: 'text-gray-500' }, 'CTR'),
                  React.createElement('div', { className: 'font-semibold' }, (d.ctr || 0) + '%')
                ),
                React.createElement('div', null,
                  React.createElement('div', { className: 'text-gray-500' }, 'Impressions'),
                  React.createElement('div', { className: 'font-semibold' }, ((d.impressions || 0)/1000000).toFixed(1) + 'M')
                ),
                React.createElement('div', null,
                  React.createElement('div', { className: 'text-gray-500' }, 'Spend'),
                  React.createElement('div', { className: 'font-semibold' }, '$' + ((d.spend || 0)/1000).toFixed(0) + 'k')
                ),
                React.createElement('div', null,
                  React.createElement('div', { className: 'text-gray-500' }, 'CPM'),
                  React.createElement('div', { className: 'font-semibold' }, 
                    '$' + (d.impressions > 0 ? ((d.spend / d.impressions) * 1000).toFixed(2) : '0')
                  )
                ),
                React.createElement('div', null,
                  React.createElement('div', { className: 'text-gray-500' }, 'CPA'),
                  React.createElement('div', { className: 'font-semibold' }, 
                    '$' + (d.conversions > 0 ? (d.spend / d.conversions).toFixed(2) : '0')
                  )
                ),
                React.createElement('div', null,
                  React.createElement('div', { className: 'text-gray-500' }, 'Clicks'),
                  React.createElement('div', { className: 'font-semibold' }, ((d.clicks || 0)/1000).toFixed(1) + 'k')
                )
              )
            );
          })
        )
      )
    );
  }
  
  // Now continue with the existing visualizations...
  // VIDEO COMPLETION RATE VISUALIZATION
 
  if (primaryMetric === 'video_completion_rate') {
    const maxRate = Math.max(...items.map(item => data[item].video_completion_rate || 0));
    const totalStarts = Object.values(data).reduce((sum, d) => sum + (d.video_starts || 0), 0);
    const totalCompletions = Object.values(data).reduce((sum, d) => sum + (d.views_100 || 0), 0);
    const overallRate = totalStarts > 0 ? ((totalCompletions / totalStarts) * 100).toFixed(1) : 0;
    
    return React.createElement('div', { className: 'mt-4 space-y-6' },
      // Video Summary Cards
      React.createElement('div', { className: 'grid grid-cols-3 gap-3 mb-6' },
        React.createElement('div', { className: 'bg-blue-50 rounded-lg p-3 border border-blue-200' },
          React.createElement('div', { className: 'text-xs text-gray-600' }, 'Total Video Starts'),
          React.createElement('div', { className: 'text-lg font-bold text-blue-600' }, (totalStarts/1000000).toFixed(1) + 'M')
        ),
        React.createElement('div', { className: 'bg-green-50 rounded-lg p-3 border border-green-200' },
          React.createElement('div', { className: 'text-xs text-gray-600' }, 'Completed Views'),
          React.createElement('div', { className: 'text-lg font-bold text-green-600' }, (totalCompletions/1000000).toFixed(1) + 'M')
        ),
        React.createElement('div', { className: 'bg-purple-50 rounded-lg p-3 border border-purple-200' },
          React.createElement('div', { className: 'text-xs text-gray-600' }, 'Overall Completion'),
          React.createElement('div', { className: 'text-lg font-bold text-purple-600' }, overallRate + '%')
        )
      ),

      // Video Completion Chart
      React.createElement('div', { className: 'bg-white rounded-lg border border-gray-200 p-4' },
        React.createElement('h3', { className: 'text-sm font-medium mb-4' }, `Video Completion Rate by ${dimensionLabel}`),
        React.createElement('div', { className: 'space-y-3' },
          items.sort((a, b) => (data[b].video_completion_rate || 0) - (data[a].video_completion_rate || 0)).map(item => {
            const colors = getColor(item);
            const rate = data[item].video_completion_rate || 0;
            return React.createElement('div', { key: item, className: 'flex items-center' },
              React.createElement('div', { className: 'w-24 text-sm truncate' }, item),
              React.createElement('div', { className: 'flex-1 mx-3' },
                React.createElement('div', { className: 'bg-gray-100 rounded-full h-6 relative' },
                  React.createElement('div', {
                    className: 'h-6 rounded-full flex items-center justify-end pr-2 text-xs font-medium',
                    style: {
                      width: (rate / maxRate * 100) + '%',
                      backgroundColor: colors.bg,
                      color: colors.text
                    }
                  }, rate + '%')
                )
              ),
              React.createElement('div', { className: 'text-xs text-gray-500 text-right w-20' }, 
                (data[item].views_100 || 0) > 1000 ? 
                  ((data[item].views_100 || 0)/1000).toFixed(0) + 'k views' : 
                  (data[item].views_100 || 0) + ' views'
              )
            );
          })
        )
      ),

      // Video Funnel
      React.createElement('div', { className: 'bg-white rounded-lg border border-gray-200 p-4' },
        React.createElement('h3', { className: 'text-sm font-medium mb-4' }, 'Video Engagement Funnel'),
        React.createElement('div', { className: 'space-y-3' },
          items.slice(0, 3).map(item => {
            const d = data[item];
            const starts = d.video_starts || 0;
            return React.createElement('div', { key: item },
              React.createElement('div', { className: 'text-sm font-medium mb-2' }, item),
              React.createElement('div', { className: 'space-y-1' },
                ['Start', '3s', '25%', '50%', '100%'].map((label, idx) => {
                  const values = [starts, d.views_3s, d.views_25, d.views_50, d.views_100];
                  const percentage = starts > 0 ? (values[idx] / starts * 100) : 0;
                  return React.createElement('div', { key: label, className: 'flex items-center' },
                    React.createElement('div', { className: 'w-10 text-xs' }, label),
                    React.createElement('div', { className: 'flex-1 mx-2 bg-gray-100 rounded h-3' },
                      React.createElement('div', {
                        className: 'bg-blue-500 h-3 rounded',
                        style: { width: percentage + '%' }
                      })
                    ),
                    React.createElement('div', { className: 'text-xs text-gray-500' }, percentage.toFixed(0) + '%')
                  );
                })
              )
            );
          })
        )
      )
    );
  }

  // CTR VISUALIZATION
  else if (primaryMetric === 'ctr') {
    const maxCTR = Math.max(...items.map(item => data[item].ctr || 0));
    const totalImpressions = Object.values(data).reduce((sum, d) => sum + (d.impressions || 0), 0);
    const totalClicks = Object.values(data).reduce((sum, d) => sum + (d.clicks || 0), 0);
    const overallCTR = totalImpressions > 0 ? ((totalClicks / totalImpressions) * 100).toFixed(2) : 0;
    
    return React.createElement('div', { className: 'mt-4 space-y-6' },
      // CTR Summary Cards
      React.createElement('div', { className: 'grid grid-cols-3 gap-3 mb-6' },
        React.createElement('div', { className: 'bg-gray-50 rounded-lg p-3 border border-gray-200' },
          React.createElement('div', { className: 'text-xs text-gray-600' }, 'Total Impressions'),
          React.createElement('div', { className: 'text-lg font-bold' }, (totalImpressions/1000000).toFixed(1) + 'M')
        ),
        React.createElement('div', { className: 'bg-blue-50 rounded-lg p-3 border border-blue-200' },
          React.createElement('div', { className: 'text-xs text-gray-600' }, 'Total Clicks'),
          React.createElement('div', { className: 'text-lg font-bold text-blue-600' }, (totalClicks/1000).toFixed(0) + 'k')
        ),
        React.createElement('div', { className: 'bg-green-50 rounded-lg p-3 border border-green-200' },
          React.createElement('div', { className: 'text-xs text-gray-600' }, 'Overall CTR'),
          React.createElement('div', { className: 'text-lg font-bold text-green-600' }, overallCTR + '%')
        )
      ),

      // CTR Chart
      React.createElement('div', { className: 'bg-white rounded-lg border border-gray-200 p-4' },
        React.createElement('h3', { className: 'text-sm font-medium mb-4' }, `Click-Through Rate by ${dimensionLabel}`),
        React.createElement('div', { className: 'space-y-3' },
          items.sort((a, b) => (data[b].ctr || 0) - (data[a].ctr || 0)).map(item => {
            const colors = getColor(item);
            return React.createElement('div', { key: item, className: 'flex items-center' },
              React.createElement('div', { className: 'w-24 text-sm truncate' }, item),
              React.createElement('div', { className: 'flex-1 mx-3' },
                React.createElement('div', { className: 'bg-gray-100 rounded-full h-6 relative' },
                  React.createElement('div', {
                    className: 'h-6 rounded-full flex items-center justify-end pr-2 text-xs font-medium',
                    style: {
                      width: ((data[item].ctr || 0) / maxCTR * 100) + '%',
                      backgroundColor: colors.bg,
                      color: colors.text
                    }
                  }, (data[item].ctr || 0).toFixed(2) + '%')
                )
              ),
              React.createElement('div', { className: 'text-xs text-gray-500' }, 
                ((data[item].clicks || 0)/1000).toFixed(1) + 'k clicks'
              )
            );
          })
        )
      )
    );
  }

  // CPA VISUALIZATION
  else if (primaryMetric === 'cpa') {
    const items_sorted = items.sort((a, b) => (data[a].cpa || 999) - (data[b].cpa || 999));
    const maxCPA = Math.max(...items.map(item => data[item].cpa || 0));
    const totalSpend = Object.values(data).reduce((sum, d) => sum + (d.spend || 0), 0);
    const totalConversions = Object.values(data).reduce((sum, d) => sum + (d.conversions || 0), 0);
    const overallCPA = totalConversions > 0 ? (totalSpend / totalConversions).toFixed(2) : 0;
    
    return React.createElement('div', { className: 'mt-4 space-y-6' },
      // CPA Summary Cards
      React.createElement('div', { className: 'grid grid-cols-3 gap-3 mb-6' },
        React.createElement('div', { className: 'bg-gray-50 rounded-lg p-3 border border-gray-200' },
          React.createElement('div', { className: 'text-xs text-gray-600' }, 'Total Spend'),
          React.createElement('div', { className: 'text-lg font-bold' }, '$' + (totalSpend/1000).toFixed(0) + 'k')
        ),
        React.createElement('div', { className: 'bg-purple-50 rounded-lg p-3 border border-purple-200' },
          React.createElement('div', { className: 'text-xs text-gray-600' }, 'Total Conversions'),
          React.createElement('div', { className: 'text-lg font-bold text-purple-600' }, (totalConversions/1000).toFixed(1) + 'k')
        ),
        React.createElement('div', { className: 'bg-green-50 rounded-lg p-3 border border-green-200' },
          React.createElement('div', { className: 'text-xs text-gray-600' }, 'Overall CPA'),
          React.createElement('div', { className: 'text-lg font-bold text-green-600' }, '$' + overallCPA)
        )
      ),

      // CPA Chart (Lower is Better)
      React.createElement('div', { className: 'bg-white rounded-lg border border-gray-200 p-4' },
        React.createElement('h3', { className: 'text-sm font-medium mb-4' }, `Cost Per Acquisition by ${dimensionLabel} (Lower is Better)`),
        React.createElement('div', { className: 'space-y-3' },
          items_sorted.map(item => {
            const colors = getColor(item);
            const cpa = data[item].cpa || 0;
            // Invert the bar width since lower CPA is better
            const barWidth = maxCPA > 0 ? ((maxCPA - cpa) / maxCPA * 80 + 20) : 20;
            
            return React.createElement('div', { key: item, className: 'flex items-center' },
              React.createElement('div', { className: 'w-24 text-sm truncate' }, item),
              React.createElement('div', { className: 'flex-1 mx-3' },
                React.createElement('div', { className: 'bg-gray-100 rounded-full h-6 relative' },
                  React.createElement('div', {
                    className: 'h-6 rounded-full flex items-center justify-start pl-2 text-xs font-medium',
                    style: {
                      width: barWidth + '%',
                      backgroundColor: colors.bg,
                      color: colors.text
                    }
                  }, '$' + cpa.toFixed(2))
                )
              ),
              React.createElement('div', { className: 'text-xs text-gray-500' }, 
                ((data[item].conversions || 0)/1000).toFixed(1) + 'k conv'
              )
            );
          })
        )
      )
    );
  }

  // CONVERSION RATE VISUALIZATION
  else if (primaryMetric === 'conversion_rate' || primaryMetric === 'conversions') {
    const maxConvRate = Math.max(...items.map(item => data[item].conversionRate || 0));
    const totalClicks = Object.values(data).reduce((sum, d) => sum + (d.clicks || 0), 0);
    const totalConversions = Object.values(data).reduce((sum, d) => sum + (d.conversions || 0), 0);
    const overallConvRate = totalClicks > 0 ? ((totalConversions / totalClicks) * 100).toFixed(2) : 0;
    
    return React.createElement('div', { className: 'mt-4 space-y-6' },
      // Conversion Summary Cards
      React.createElement('div', { className: 'grid grid-cols-3 gap-3 mb-6' },
        React.createElement('div', { className: 'bg-gray-50 rounded-lg p-3 border border-gray-200' },
          React.createElement('div', { className: 'text-xs text-gray-600' }, 'Total Clicks'),
          React.createElement('div', { className: 'text-lg font-bold' }, (totalClicks/1000).toFixed(0) + 'k')
        ),
        React.createElement('div', { className: 'bg-purple-50 rounded-lg p-3 border border-purple-200' },
          React.createElement('div', { className: 'text-xs text-gray-600' }, 'Total Conversions'),
          React.createElement('div', { className: 'text-lg font-bold text-purple-600' }, (totalConversions/1000).toFixed(1) + 'k')
        ),
        React.createElement('div', { className: 'bg-green-50 rounded-lg p-3 border border-green-200' },
          React.createElement('div', { className: 'text-xs text-gray-600' }, 'Overall Conv. Rate'),
          React.createElement('div', { className: 'text-lg font-bold text-green-600' }, overallConvRate + '%')
        )
      ),

      // Conversion Rate Chart
      React.createElement('div', { className: 'bg-white rounded-lg border border-gray-200 p-4' },
        React.createElement('h3', { className: 'text-sm font-medium mb-4' }, `Conversion Rate by ${dimensionLabel}`),
        React.createElement('div', { className: 'space-y-3' },
          items.sort((a, b) => (data[b].conversionRate || 0) - (data[a].conversionRate || 0)).map(item => {
            const colors = getColor(item);
            return React.createElement('div', { key: item, className: 'flex items-center' },
              React.createElement('div', { className: 'w-24 text-sm truncate' }, item),
              React.createElement('div', { className: 'flex-1 mx-3' },
                React.createElement('div', { className: 'bg-gray-100 rounded-full h-6 relative' },
                  React.createElement('div', {
                    className: 'h-6 rounded-full flex items-center justify-end pr-2 text-xs font-medium',
                    style: {
                      width: ((data[item].conversionRate || 0) / maxConvRate * 100) + '%',
                      backgroundColor: colors.bg,
                      color: colors.text
                    }
                  }, (data[item].conversionRate || 0).toFixed(2) + '%')
                )
              ),
              React.createElement('div', { className: 'text-xs text-gray-500' }, 
                ((data[item].conversions || 0)/1000).toFixed(1) + 'k conversions'
              )
            );
          })
        )
      )
    );
  }

  // SPEND ONLY VISUALIZATION
  else if (primaryMetric === 'spend') {
    const maxSpend = Math.max(...items.map(item => data[item].spend || 0));
    const totalSpend = Object.values(data).reduce((sum, d) => sum + (d.spend || 0), 0);
    
    return React.createElement('div', { className: 'mt-4 space-y-6' },
      // Single Summary Card
      React.createElement('div', { className: 'bg-gray-50 rounded-lg p-4 border border-gray-200 mb-6' },
        React.createElement('div', { className: 'text-xs text-gray-600' }, 'Total Ad Spend'),
        React.createElement('div', { className: 'text-2xl font-bold' }, '$' + (totalSpend/1000).toFixed(0) + 'k')
      ),

      // Spend Chart
      React.createElement('div', { className: 'bg-white rounded-lg border border-gray-200 p-4' },
        React.createElement('h3', { className: 'text-sm font-medium mb-4' }, `Ad Spend by ${dimensionLabel}`),
        React.createElement('div', { className: 'space-y-3' },
          items.sort((a, b) => (data[b].spend || 0) - (data[a].spend || 0)).map(item => {
            const colors = getColor(item);
            return React.createElement('div', { key: item, className: 'flex items-center' },
              React.createElement('div', { className: 'w-24 text-sm truncate' }, item),
              React.createElement('div', { className: 'flex-1 mx-3' },
                React.createElement('div', { className: 'bg-gray-100 rounded-full h-6 relative' },
                  React.createElement('div', {
                    className: 'h-6 rounded-full flex items-center justify-end pr-2 text-xs font-medium',
                    style: {
                      width: ((data[item].spend || 0) / maxSpend * 100) + '%',
                      backgroundColor: colors.bg,
                      color: colors.text
                    }
                  }, '$' + ((data[item].spend || 0)/1000).toFixed(1) + 'k')
                )
              )
            );
          })
        )
      )
    );
  }




      // IMPRESSIONS VISUALIZATION
  else if (primaryMetric === 'impressions') {
    const maxImpressions = Math.max(...items.map(item => data[item].impressions || 0));
    const totalImpressions = Object.values(data).reduce((sum, d) => sum + (d.impressions || 0), 0);
    
    return React.createElement('div', { className: 'mt-4 space-y-6' },
      // Summary Card
      React.createElement('div', { className: 'bg-blue-50 rounded-lg p-4 border border-blue-200 mb-6' },
        React.createElement('div', { className: 'text-xs text-gray-600' }, 'Total Impressions'),
        React.createElement('div', { className: 'text-2xl font-bold text-blue-600' }, (totalImpressions/1000000).toFixed(1) + 'M')
      ),
  
      // Impressions Chart
      React.createElement('div', { className: 'bg-white rounded-lg border border-gray-200 p-4' },
        React.createElement('h3', { className: 'text-sm font-medium mb-4' }, `Impressions by ${dimensionLabel}`),
        React.createElement('div', { className: 'space-y-3' },
          items.sort((a, b) => (data[b].impressions || 0) - (data[a].impressions || 0)).map(item => {
            const colors = getColor(item);
            return React.createElement('div', { key: item, className: 'flex items-center' },
              React.createElement('div', { className: 'w-24 text-sm truncate' }, item),
              React.createElement('div', { className: 'flex-1 mx-3' },
                React.createElement('div', { className: 'bg-gray-100 rounded-full h-6 relative' },
                  React.createElement('div', {
                    className: 'h-6 rounded-full flex items-center justify-end pr-2 text-xs font-medium',
                    style: {
                      width: ((data[item].impressions || 0) / maxImpressions * 100) + '%',
                      backgroundColor: colors.bg,
                      color: colors.text
                    }
                  }, ((data[item].impressions || 0)/1000000).toFixed(1) + 'M')
                )
              )
            );
          })
        )
      )
    );
  }
  
  // CPM VISUALIZATION
  else if (primaryMetric === 'cpm') {
    const items_sorted = items.sort((a, b) => {
      const cpmA = data[a].impressions > 0 ? (data[a].spend / data[a].impressions * 1000) : 999;
      const cpmB = data[b].impressions > 0 ? (data[b].spend / data[b].impressions * 1000) : 999;
      return cpmA - cpmB;
    });
    
    return React.createElement('div', { className: 'mt-4 space-y-6' },
      // CPM Chart (Lower is Better)
      React.createElement('div', { className: 'bg-white rounded-lg border border-gray-200 p-4' },
        React.createElement('h3', { className: 'text-sm font-medium mb-4' }, `Cost Per 1000 Impressions by ${dimensionLabel} (Lower is Better)`),
        React.createElement('div', { className: 'space-y-3' },
          items_sorted.map(item => {
            const colors = getColor(item);
            const cpm = data[item].impressions > 0 ? (data[item].spend / data[item].impressions * 1000) : 0;
            
            return React.createElement('div', { key: item, className: 'flex items-center' },
              React.createElement('div', { className: 'w-24 text-sm truncate' }, item),
              React.createElement('div', { className: 'flex-1 mx-3' },
                React.createElement('div', { className: 'bg-gray-100 rounded-full h-6 relative' },
                  React.createElement('div', {
                    className: 'h-6 rounded-full flex items-center justify-start pl-2 text-xs font-medium',
                    style: {
                      width: '80%',
                      backgroundColor: colors.bg,
                      color: colors.text
                    }
                  }, '$' + cpm.toFixed(2))
                )
              ),
              React.createElement('div', { className: 'text-xs text-gray-500' }, 
                ((data[item].impressions || 0)/1000000).toFixed(1) + 'M impressions'
              )
            );
          })
        )
      )
    );
  }
  
  // DEFAULT: FINANCIAL METRICS (ROAS, Revenue, etc.)
  else {
    const maxROAS = Math.max(...items.map(item => data[item].roas || 0));
    const totalSpend = Object.values(data).reduce((sum, d) => sum + (d.spend || 0), 0);
    const totalRevenue = Object.values(data).reduce((sum, d) => sum + (d.revenue || 0), 0);
    const overallROAS = totalSpend > 0 ? (totalRevenue / totalSpend).toFixed(2) : 0;
    const totalConversions = Object.values(data).reduce((sum, d) => sum + (d.conversions || 0), 0);
    
    return React.createElement('div', { className: 'mt-4 space-y-6' },
      // Financial Summary Cards
      React.createElement('div', { className: 'grid grid-cols-4 gap-3 mb-6' },
        React.createElement('div', { className: 'bg-gray-50 rounded-lg p-3 border border-gray-200' },
          React.createElement('div', { className: 'text-xs text-gray-600' }, 'Total Spend'),
          React.createElement('div', { className: 'text-lg font-bold' }, '$' + (totalSpend/1000).toFixed(0) + 'k')
        ),
        React.createElement('div', { className: 'bg-green-50 rounded-lg p-3 border border-green-200' },
          React.createElement('div', { className: 'text-xs text-gray-600' }, 'Total Revenue'),
          React.createElement('div', { className: 'text-lg font-bold text-green-600' }, '$' + (totalRevenue/1000).toFixed(0) + 'k')
        ),
        React.createElement('div', { className: 'bg-blue-50 rounded-lg p-3 border border-blue-200' },
          React.createElement('div', { className: 'text-xs text-gray-600' }, 'Overall ROAS'),
          React.createElement('div', { className: 'text-lg font-bold text-blue-600' }, overallROAS + 'x')
        ),
        React.createElement('div', { className: 'bg-purple-50 rounded-lg p-3 border border-purple-200' },
          React.createElement('div', { className: 'text-xs text-gray-600' }, 'Conversions'),
          React.createElement('div', { className: 'text-lg font-bold text-purple-600' }, (totalConversions/1000).toFixed(1) + 'k')
        )
      ),

      // ROAS Chart
      React.createElement('div', { className: 'bg-white rounded-lg border border-gray-200 p-4' },
        React.createElement('h3', { className: 'text-sm font-medium mb-4' }, `Return on Ad Spend by ${dimensionLabel}`),
        React.createElement('div', { className: 'space-y-3' },
          items.sort((a, b) => (data[b].roas || 0) - (data[a].roas || 0)).map(item => {
            const colors = getColor(item);
            return React.createElement('div', { key: item, className: 'flex items-center' },
              React.createElement('div', { className: 'w-24 text-sm truncate' }, item),
              React.createElement('div', { className: 'flex-1 mx-3' },
                React.createElement('div', { className: 'bg-gray-100 rounded-full h-6 relative' },
                  React.createElement('div', {
                    className: 'h-6 rounded-full flex items-center justify-end pr-2 text-xs font-medium',
                    style: {
                      width: ((data[item].roas || 0) / maxROAS * 100) + '%',
                      backgroundColor: colors.bg,
                      color: colors.text
                    }
                  }, (data[item].roas || 0) + 'x')
                )
              )
            );
          })
        )
      ),

      // Spend vs Revenue
      React.createElement('div', { className: 'bg-white rounded-lg border border-gray-200 p-4' },
        React.createElement('h3', { className: 'text-sm font-medium mb-4' }, 'Spend vs Revenue'),
        React.createElement('div', { className: 'space-y-3' },
          items.map(item =>
            React.createElement('div', { key: item },
              React.createElement('div', { className: 'text-sm mb-1 truncate' }, item),
              React.createElement('div', { className: 'flex gap-2 items-center' },
                React.createElement('div', { className: 'text-xs w-12' }, 'Spend'),
                React.createElement('div', { 
                  className: 'h-4 bg-red-500 rounded',
                  style: { width: ((data[item].spend || 0) / 1000) + 'px', maxWidth: '300px' }
                }),
                React.createElement('div', { className: 'text-xs' }, '$' + ((data[item].spend || 0)/1000).toFixed(0) + 'k')
              ),
              React.createElement('div', { className: 'flex gap-2 items-center mt-1' },
                React.createElement('div', { className: 'text-xs w-12' }, 'Rev'),
                React.createElement('div', { 
                  className: 'h-4 bg-green-500 rounded',
                  style: { width: ((data[item].revenue || 0) / 1000) + 'px', maxWidth: '300px' }
                }),
                React.createElement('div', { className: 'text-xs' }, '$' + ((data[item].revenue || 0)/1000).toFixed(0) + 'k')
              )
            )
          )
        )
      )
    );
  }
}

    // Password Modal Component
    function PasswordModal({ onClose, onSuccess }) {
      const [password, setPassword] = useState('');
      const [error, setError] = useState(false);
      const correctPassword = 'iamyoursmartaiagent';

      const handleSubmit = () => {
        if (password === correctPassword) {
          onSuccess();
        } else {
          setError(true);
          setTimeout(() => setError(false), 2000);
        }
      };

      const handleKeyPress = (e) => {
        if (e.key === 'Enter') {
          handleSubmit();
        }
      };

      return React.createElement('div', { 
        className: 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50',
        onClick: onClose
      },
        React.createElement('div', { 
          className: 'bg-white rounded-xl p-6 max-w-sm w-full mx-4 shadow-xl',
          onClick: (e) => e.stopPropagation()
        },
          React.createElement('p', { className: 'text-gray-800 mb-4' }, 
            'Kristen, you gotta type password to access agent configs :)'
          ),
          React.createElement('input', {
            type: 'password',
            value: password,
            onChange: (e) => setPassword(e.target.value),
            onKeyPress: handleKeyPress,
            placeholder: 'Enter password',
            className: `w-full px-4 py-2 border ${error ? 'border-red-500' : 'border-gray-300'} rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4`
          }),
          error && React.createElement('p', { className: 'text-red-500 text-sm mb-4' }, 'Incorrect password!'),
          React.createElement('div', { className: 'flex gap-3' },
            React.createElement('button', {
              onClick: onClose,
              className: 'flex-1 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50'
            }, 'Cancel'),
            React.createElement('button', {
              onClick: handleSubmit,
              className: 'flex-1 px-4 py-2 bg-gray-900 text-white rounded-lg hover:bg-gray-800'
            }, 'Done')
          )
        )
      );
    }

    function AdAgentOS() {
      const [messages, setMessages] = useState([
        { role: 'assistant', content: 'Hello! I\'m your AI performance analyst. Ask me about your video ad campaigns.' }
      ]);
      const [input, setInput] = useState('');
      const [isLoading, setIsLoading] = useState(false);
      const [showPasswordModal, setShowPasswordModal] = useState(false);
      const [thinkingMessage, setThinkingMessage] = useState('');
      const messagesEndRef = useRef(null);

      const scrollToBottom = () => {
        messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
      };

      useEffect(() => {
        scrollToBottom();
      }, [messages]);

      // Get context-aware thinking messages
      const getThinkingMessages = (userMessage) => {
        const lower = userMessage.toLowerCase();
        
        if (lower.includes('invest') || lower.includes('budget') || lower.includes('allocate')) {
          return [
            "ðŸ¤” I see you're looking for investment advice...",
            "ðŸ“Š Analyzing performance across all platforms...",
            "ðŸ’° Calculating which platforms give the best returns...",
            "ðŸŽ¯ Identifying opportunities for budget reallocation...",
            "âœï¸ Preparing strategic recommendations..."
          ];
        } else if (lower.includes('compare')) {
          return [
            "ðŸ¤” Got it, you want to compare performance...",
            "ðŸ” Finding the data for comparison...",
            "ðŸ“Š Calculating metrics for each option...",
            "ðŸ“ˆ Analyzing the differences...",
            "âœï¸ Summarizing what I found..."
          ];
        } else if (lower.includes('ctr') || lower.includes('click')) {
          return [
            "ðŸ¤” Looking at click performance...",
            "ðŸ–±ï¸ Gathering click and impression data...",
            "ðŸ“Š Calculating click-through rates...",
            "ðŸ“ˆ Identifying the best performers...",
            "âœï¸ Preparing your CTR analysis..."
          ];
        } else if (lower.includes('conversion')) {
          return [
            "ðŸ¤” Analyzing conversion metrics...",
            "ðŸŽ¯ Gathering conversion data...",
            "ðŸ“Š Calculating conversion rates...",
            "ðŸ’¡ Finding conversion insights...",
            "âœï¸ Writing up the analysis..."
          ];
        } else {
          // Default messages
          return [
            "ðŸ¤” Understanding your question...",
            "ðŸ” Looking through your campaign data...",
            "ðŸ“Š Running the calculations...",
            "ðŸ’¡ Finding the key insights...",
            "âœï¸ Preparing your answer..."
          ];
        }
      };

      const handleSend = async (messageText = null) => {
        const userMessage = messageText || input;
        if (!userMessage.trim()) return;
        
        if (!messageText) {
          setInput('');
        }
        setMessages(prev => [...prev, { role: 'user', content: userMessage }]);
        setIsLoading(true);
        
        // Extract conversation history (last 5 exchanges)
        const conversationHistory = messages
          .slice(-10)
          .map(msg => ({
            role: msg.role,
            content: msg.content,
            goal: msg.goal
          }));
        
        // Simple initial message instead of complex stages
        setThinkingMessage("ðŸ¤” Processing your request...");
        
        try {
          const response = await fetch('https://adagentos-backend-production.up.railway.app/chat', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ 
              message: userMessage,
              conversationHistory: conversationHistory
            })
          });
          
          const data = await response.json();
            if (data.visualization) {
             console.log('Visualization object:', JSON.stringify(data.visualization, null, 2));
            }
          console.log('Analysis steps:', data.analysisSteps);
          
          // Show dynamic analysis steps if available
          if (data.analysisSteps && data.analysisSteps.length > 0) {
            let stepIndex = 0;
            // Immediately show first dynamic step
            setThinkingMessage(data.analysisSteps[0]);
            
            const stepInterval = setInterval(() => {
              stepIndex++;
              if (stepIndex < data.analysisSteps.length) {
                setThinkingMessage(data.analysisSteps[stepIndex]);
              } else {
                clearInterval(stepInterval);
                setTimeout(() => {
                  setThinkingMessage('');
                  setMessages(prev => [...prev, { 
                    role: 'assistant', 
                    content: data.answer || 'No response received',
                    sql: data.sql,
                    visualization: data.visualization,
                    goal: data.goal 
                  }]);
                  setIsLoading(false);
                }, 800);
              }
            }, 1200);
          } else {
            // No dynamic steps, show answer immediately
            setThinkingMessage('');
            setMessages(prev => [...prev, { 
              role: 'assistant', 
              content: data.answer || 'No response received',
              sql: data.sql,
              visualization: data.visualization,
              goal: data.goal 
            }]);
            setIsLoading(false);
          }
          
        } catch (error) {
          console.error('Error:', error);
          setThinkingMessage('');
          setMessages(prev => [...prev, { 
            role: 'assistant', 
            content: 'Error connecting to backend. Please check console.' 
          }]);
          setIsLoading(false);
        }
      };

      const handleKeyPress = (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          handleSend();
        }
      };

      const handleConfigClick = () => {
        setShowPasswordModal(true);
      };

      const handlePasswordSuccess = () => {
        setShowPasswordModal(false);
        window.location.href = 'agent_config.html';
      };

      const handleExampleClick = (question) => {
        setInput(question);
        handleSend(question);
      };

      return React.createElement('div', { className: 'flex h-screen bg-white' },
          // Add config and docs buttons in top right
        React.createElement('div', { 
          style: { position: 'absolute', top: '20px', right: '20px', zIndex: 10 } 
        },
          React.createElement('button', {
            onClick: () => window.location.href = 'docs.html',
            className: 'px-4 py-2 bg-white border border-gray-200 text-gray-700 text-sm font-medium rounded-lg hover:bg-gray-50 transition-colors'
          }, 'Docs')
        ),
        
        // Password Modal
        showPasswordModal && React.createElement(PasswordModal, {
          onClose: () => setShowPasswordModal(false),
          onSuccess: handlePasswordSuccess
        }),
        
        React.createElement('div', { className: 'flex-1 flex flex-col' },
          React.createElement('div', { className: 'border-b border-gray-100 px-8 py-6' },
            React.createElement('div', { className: 'flex items-center justify-between' },
              React.createElement('div', null,
                React.createElement('h1', { className: 'text-2xl font-light text-gray-900' }, 'AdAgentOS'),
                React.createElement('p', { className: 'text-sm text-gray-500 mt-1' }, 'AI Performance Analyst')
              )
            )
          ),
          
          // Show Welcome State when messages are minimal, otherwise show chat
          React.createElement('div', { className: 'flex-1 overflow-y-auto' },
            messages.length <= 1 
              ? React.createElement(WelcomeState, {
                  onExampleClick: handleExampleClick
                })
              : React.createElement('div', { className: 'px-8 py-6' },
                  React.createElement('div', { className: 'max-w-4xl mx-auto space-y-6' },
                    messages.map((message, idx) => 
                      React.createElement('div', { key: idx },
                        React.createElement('div', { 
                          className: `flex ${message.role === 'user' ? 'justify-end' : 'justify-start'} mb-2` 
                        },
                          React.createElement('div', { 
                            className: `max-w-2xl ${message.role === 'user' ? 'bg-gray-900 text-white' : 'bg-gray-50 text-gray-900'} rounded-2xl px-6 py-4` 
                          },
                            message.role === 'user' 
                              ? React.createElement('p', { className: 'text-sm' }, message.content)
                              : React.createElement('div', null,
                                  message.sql && React.createElement(CollapsibleSQL, { sql: message.sql }),
                                  React.createElement('div', { 
                                    className: 'text-sm',
                                    dangerouslySetInnerHTML: { __html: formatText(message.content) }
                                  })
                                )
                          )
                        ),
                        message.visualization && React.createElement(DynamicVisualization, { visualization: message.visualization })
                      )
                    ),
                    // Show thinking message
                    isLoading && React.createElement('div', { className: 'flex justify-start' },
                      React.createElement('div', { className: 'bg-gray-50 rounded-2xl px-6 py-4' },
                        React.createElement('span', { className: 'text-gray-600 text-sm' }, thinkingMessage)
                      )
                    ),
                    React.createElement('div', { ref: messagesEndRef })
                  )
                )
          ),
          
          // Chat input (always visible)
          React.createElement('div', { className: 'border-t border-gray-100 px-8 py-6' },
            React.createElement('div', { className: 'max-w-4xl mx-auto' },
              React.createElement('div', { className: 'flex items-end space-x-4' },
                React.createElement('textarea', {
                  value: input,
                  onChange: (e) => setInput(e.target.value),
                  onKeyPress: handleKeyPress,
                  placeholder: 'Ask about campaign performance...',
                  className: 'flex-1 px-4 py-3 bg-gray-50 rounded-xl resize-none focus:outline-none focus:ring-2 focus:ring-gray-200',
                  rows: '1',
                  style: { minHeight: '48px' }
                }),
                React.createElement('button', {
                  onClick: () => handleSend(),
                  disabled: isLoading || !input.trim(),
                  className: 'p-3 bg-gray-900 text-white rounded-xl hover:bg-gray-800 disabled:opacity-50'
                }, React.createElement('span', null, 'âž¤'))
              )
            )
          )
        )
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(React.createElement(AdAgentOS));
  </script>
</body>
</html>
