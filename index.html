<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AdAgentOS - AI Performance Analyst</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif; }
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-thumb { background: #e5e5e5; border-radius: 3px; }
    .sql-code {
      background: #1e1e1e;
      color: #d4d4d4;
      padding: 12px;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      overflow-x: auto;
      white-space: pre;
    }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState, useRef, useEffect } = React;

    function formatText(text) {
      // Simple markdown-like formatting
      return text
        .replace(/### (.*?)$/gm, '<h3 class="font-semibold text-lg mb-2 mt-4">$1</h3>')
        .replace(/\*\*(.*?)\*\*/g, '<strong class="font-semibold">$1</strong>')
        .replace(/â€¢ /g, '')
        .replace(/- (.*?)$/gm, '<div class="ml-4 mb-1">â†’ $1</div>')
        .replace(/\d+\. (.*?)$/gm, '<div class="ml-4 mb-2 font-medium">$&</div>')
        .replace(/\n/g, '<br/>');
    }

    function CollapsibleSQL({ sql }) {
      const [isExpanded, setIsExpanded] = useState(false);

      if (!sql) return null;

      return (
        <div className="mb-3 mt-2">
          <button
            onClick={() => setIsExpanded(!isExpanded)}
            className="flex items-center gap-2 text-sm text-gray-600 hover:text-gray-900 transition-colors"
          >
            <span>{isExpanded ? 'â–¼' : 'â–¶'}</span>
            <span className="font-medium">View SQL Query</span>
          </button>
          {isExpanded && (
            <div className="mt-2 sql-code">
              {sql}
            </div>
          )}
        </div>
      );
    }

    function MetricsDisplay({ metrics }) {
      if (!metrics || Object.keys(metrics).length === 0) return null;

      const platforms = Object.keys(metrics);
      const totalSpend = Object.values(metrics).reduce((sum, m) => sum + (m.spend || 0), 0);
      const totalRevenue = Object.values(metrics).reduce((sum, m) => sum + (m.revenue || 0), 0);
      const overallROAS = totalSpend > 0 ? (totalRevenue / totalSpend).toFixed(2) : 0;
      const totalConversions = Object.values(metrics).reduce((sum, m) => sum + (m.conversions || 0), 0);

      const maxROAS = Math.max(...platforms.map(p => metrics[p].roas || 0));
      const colors = {
        TikTok: '#000000',
        Instagram: '#E4405F', 
        Facebook: '#1877F2',
        YouTube: '#FF0000',
        Snapchat: '#FFFC00'
      };

      return React.createElement('div', { className: 'mt-4 space-y-6' },
        // Summary Cards
        React.createElement('div', { className: 'grid grid-cols-4 gap-3 mb-6' },
          React.createElement('div', { className: 'bg-gray-50 rounded-lg p-3 border border-gray-200' },
            React.createElement('div', { className: 'text-xs text-gray-600' }, 'Total Spend'),
            React.createElement('div', { className: 'text-lg font-bold' }, '$' + (totalSpend/1000).toFixed(0) + 'k')
          ),
          React.createElement('div', { className: 'bg-green-50 rounded-lg p-3 border border-green-200' },
            React.createElement('div', { className: 'text-xs text-gray-600' }, 'Total Revenue'),
            React.createElement('div', { className: 'text-lg font-bold text-green-600' }, '$' + (totalRevenue/1000).toFixed(0) + 'k')
          ),
          React.createElement('div', { className: 'bg-blue-50 rounded-lg p-3 border border-blue-200' },
            React.createElement('div', { className: 'text-xs text-gray-600' }, 'Overall ROAS'),
            React.createElement('div', { className: 'text-lg font-bold text-blue-600' }, overallROAS + 'x')
          ),
          React.createElement('div', { className: 'bg-purple-50 rounded-lg p-3 border border-purple-200' },
            React.createElement('div', { className: 'text-xs text-gray-600' }, 'Conversions'),
            React.createElement('div', { className: 'text-lg font-bold text-purple-600' }, (totalConversions/1000).toFixed(1) + 'k')
          )
        ),

        // ROAS Chart
        React.createElement('div', { className: 'bg-white rounded-lg border border-gray-200 p-4' },
          React.createElement('h3', { className: 'text-sm font-medium mb-4' }, 'Return on Ad Spend (ROAS)'),
          React.createElement('div', { className: 'space-y-3' },
            platforms.sort((a,b) => (metrics[b].roas || 0) - (metrics[a].roas || 0)).map(platform =>
              React.createElement('div', { key: platform, className: 'flex items-center' },
                React.createElement('div', { className: 'w-20 text-sm' }, platform),
                React.createElement('div', { className: 'flex-1 mx-3' },
                  React.createElement('div', { className: 'bg-gray-100 rounded-full h-6 relative' },
                    React.createElement('div', {
                      className: 'h-6 rounded-full flex items-center justify-end pr-2 text-xs text-white font-medium',
                      style: {
                        width: ((metrics[platform].roas || 0) / maxROAS * 100) + '%',
                        backgroundColor: colors[platform] || '#666'
                      }
                    }, (metrics[platform].roas || 0) + 'x')
                  )
                )
              )
            )
          )
        ),

        // Spend vs Revenue
        React.createElement('div', { className: 'bg-white rounded-lg border border-gray-200 p-4' },
          React.createElement('h3', { className: 'text-sm font-medium mb-4' }, 'Spend vs Revenue'),
          React.createElement('div', { className: 'space-y-3' },
            platforms.map(platform =>
              React.createElement('div', { key: platform },
                React.createElement('div', { className: 'text-sm mb-1' }, platform),
                React.createElement('div', { className: 'flex gap-2 items-center' },
                  React.createElement('div', { className: 'text-xs w-12' }, 'Spend'),
                  React.createElement('div', { 
                    className: 'h-4 bg-red-500 rounded',
                    style: { width: ((metrics[platform].spend || 0) / totalSpend * 200) + 'px' }
                  }),
                  React.createElement('div', { className: 'text-xs' }, '$' + ((metrics[platform].spend || 0)/1000).toFixed(0) + 'k')
                ),
                React.createElement('div', { className: 'flex gap-2 items-center mt-1' },
                  React.createElement('div', { className: 'text-xs w-12' }, 'Rev'),
                  React.createElement('div', { 
                    className: 'h-4 bg-green-500 rounded',
                    style: { width: ((metrics[platform].revenue || 0) / totalRevenue * 200) + 'px' }
                  }),
                  React.createElement('div', { className: 'text-xs' }, '$' + ((metrics[platform].revenue || 0)/1000).toFixed(0) + 'k')
                )
              )
            )
          )
        )
      );
    }

    function AdAgentOS() {
      const [messages, setMessages] = useState([
        { role: 'assistant', content: 'Hello! I\'m your AI performance analyst. Ask me about your video ad campaigns.' }
      ]);
      const [input, setInput] = useState('');
      const [isLoading, setIsLoading] = useState(false);
      const [showAgents, setShowAgents] = useState(false);
      const messagesEndRef = useRef(null);

      const [agentPrompts, setAgentPrompts] = useState({
        queryGeneratorAgent: 'You are an expert SQL query generator for marketing analytics. Generate safe, efficient PostgreSQL queries based on user questions.',
        answerGeneratorAgent: 'You are a marketing performance analyst. Provide specific, data-driven insights with exact numbers from the query results.'
      });

      const scrollToBottom = () => {
        messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
      };

      useEffect(() => {
        scrollToBottom();
      }, [messages]);

      const handleSend = async () => {
        if (!input.trim()) return;

        const userMessage = input;
        setInput('');
        setMessages(prev => [...prev, { role: 'user', content: userMessage }]);
        setIsLoading(true);

        try {
          const response = await fetch('https://adagentos-backend-production.up.railway.app/chat', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ 
              message: userMessage,
              agentPrompts 
            })
          });

          const data = await response.json();
          setMessages(prev => [...prev, { 
            role: 'assistant', 
            content: data.answer || 'No response received',
            sql: data.sql,
            metrics: data.metrics 
          }]);
        } catch (error) {
          console.error('Error:', error);
          setMessages(prev => [...prev, { 
            role: 'assistant', 
            content: 'Error connecting to backend. Please check console.' 
          }]);
        } finally {
          setIsLoading(false);
        }
      };

      const handleKeyPress = (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          handleSend();
        }
      };

      return React.createElement('div', { className: 'flex h-screen bg-white' },
        React.createElement('div', { className: 'flex-1 flex flex-col' },
          React.createElement('div', { className: 'border-b border-gray-100 px-8 py-6' },
            React.createElement('div', { className: 'flex items-center justify-between' },
              React.createElement('div', null,
                React.createElement('h1', { className: 'text-2xl font-light text-gray-900' }, 'AdAgentOS'),
                React.createElement('p', { className: 'text-sm text-gray-500 mt-1' }, 'AI Performance Analyst')
              ),
              React.createElement('button', {
                onClick: () => setShowAgents(!showAgents),
                className: 'p-2 hover:bg-gray-50 rounded-lg transition-colors'
              }, React.createElement('span', null, 'âš™ï¸'))
            )
          ),
          React.createElement('div', { className: 'flex-1 overflow-y-auto px-8 py-6' },
            React.createElement('div', { className: 'max-w-4xl mx-auto space-y-6' },
              messages.map((message, idx) => 
                React.createElement('div', { key: idx },
                  React.createElement('div', { 
                    className: `flex ${message.role === 'user' ? 'justify-end' : 'justify-start'} mb-2` 
                  },
                    React.createElement('div', { 
                      className: `max-w-2xl ${message.role === 'user' ? 'bg-gray-900 text-white' : 'bg-gray-50 text-gray-900'} rounded-2xl px-6 py-4` 
                    },
                      message.role === 'user' 
                        ? React.createElement('p', { className: 'text-sm' }, message.content)
                        : React.createElement('div', null,
                            message.sql && React.createElement(CollapsibleSQL, { sql: message.sql }),
                            React.createElement('div', { 
                              className: 'text-sm',
                              dangerouslySetInnerHTML: { __html: formatText(message.content) }
                            })
                          )
                    )
                  ),
                  message.metrics && React.createElement(MetricsDisplay, { metrics: message.metrics })
                )
              ),
              isLoading && React.createElement('div', { className: 'flex justify-start' },
                React.createElement('div', { className: 'bg-gray-50 rounded-2xl px-6 py-4' },
                  React.createElement('span', { className: 'text-gray-500' }, 'Analyzing...')
                )
              ),
              React.createElement('div', { ref: messagesEndRef })
            )
          ),
          React.createElement('div', { className: 'border-t border-gray-100 px-8 py-6' },
            React.createElement('div', { className: 'max-w-4xl mx-auto' },
              React.createElement('div', { className: 'flex items-end space-x-4' },
                React.createElement('textarea', {
                  value: input,
                  onChange: (e) => setInput(e.target.value),
                  onKeyPress: handleKeyPress,
                  placeholder: 'Ask about campaign performance...',
                  className: 'flex-1 px-4 py-3 bg-gray-50 rounded-xl resize-none focus:outline-none focus:ring-2 focus:ring-gray-200',
                  rows: '1',
                  style: { minHeight: '48px' }
                }),
                React.createElement('button', {
                  onClick: handleSend,
                  disabled: isLoading || !input.trim(),
                  className: 'p-3 bg-gray-900 text-white rounded-xl hover:bg-gray-800 disabled:opacity-50'
                }, React.createElement('span', null, 'âž¤'))
              )
            )
          )
        ),
        showAgents && React.createElement('div', { className: 'w-96 border-l border-gray-100 bg-gray-50 p-6 overflow-y-auto' },
          React.createElement('h2', { className: 'text-lg font-light mb-6' }, 'Agent Configuration'),
          Object.entries(agentPrompts).map(([agent, prompt]) =>
            React.createElement('div', { key: agent, className: 'mb-4 bg-white rounded-xl p-4' },
              React.createElement('div', { className: 'text-sm font-medium mb-2' }, 
                agent === 'queryGeneratorAgent' ? 'ðŸ” Query Generator' : 'ðŸ’¡ Answer Generator'
              ),
              React.createElement('textarea', {
                value: prompt,
                onChange: (e) => setAgentPrompts(prev => ({...prev, [agent]: e.target.value})),
                className: 'w-full h-24 p-2 text-xs bg-gray-50 rounded'
              })
            )
          )
        )
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(React.createElement(AdAgentOS));
  </script>
</body>
</html>
