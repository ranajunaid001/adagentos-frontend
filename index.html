<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AdAgentOS - AI Performance Analyst</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif; }
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-thumb { background: #e5e5e5; border-radius: 3px; }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState, useRef, useEffect } = React;

    function AdAgentOS() {
      const [messages, setMessages] = useState([
        { role: 'assistant', content: 'Hello! I\'m your AI performance analyst. Ask me about your video ad campaigns.' }
      ]);
      const [input, setInput] = useState('');
      const [isLoading, setIsLoading] = useState(false);
      const [showAgents, setShowAgents] = useState(false);
      const [activeAgent, setActiveAgent] = useState(null);
      const messagesEndRef = useRef(null);

      const [agentPrompts, setAgentPrompts] = useState({
        dataAgent: 'You are a data retrieval specialist. Parse user intent and generate SQL queries.',
        analysisAgent: 'You are a performance analysis expert. Calculate ROAS, CTR, CPA metrics.',
        optimizationAgent: 'You are a marketing optimization specialist. Generate actionable recommendations.'
      });

      const scrollToBottom = () => {
        messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
      };

      useEffect(() => {
        scrollToBottom();
      }, [messages]);

      const handleSend = async () => {
        if (!input.trim()) return;

        const userMessage = input;
        setInput('');
        setMessages(prev => [...prev, { role: 'user', content: userMessage }]);
        setIsLoading(true);

        try {
          const response = await fetch('https://adagentos-backend-production.up.railway.app/chat', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ 
              message: userMessage,
              agentPrompts 
            })
          });

          const data = await response.json();
          setMessages(prev => [...prev, { 
            role: 'assistant', 
            content: data.message || 'No response received',
            metrics: data.metrics 
          }]);
        } catch (error) {
          console.error('Error:', error);
          setMessages(prev => [...prev, { 
            role: 'assistant', 
            content: 'Error connecting to backend. Please check console.' 
          }]);
        } finally {
          setIsLoading(false);
        }
      };

      const handleKeyPress = (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          handleSend();
        }
      };

      return React.createElement('div', { className: 'flex h-screen bg-white' },
        React.createElement('div', { className: 'flex-1 flex flex-col' },
          React.createElement('div', { className: 'border-b border-gray-100 px-8 py-6' },
            React.createElement('div', { className: 'flex items-center justify-between' },
              React.createElement('div', null,
                React.createElement('h1', { className: 'text-2xl font-light text-gray-900' }, 'AdAgentOS'),
                React.createElement('p', { className: 'text-sm text-gray-500 mt-1' }, 'AI Performance Analyst')
              ),
              React.createElement('button', {
                onClick: () => setShowAgents(!showAgents),
                className: 'p-2 hover:bg-gray-50 rounded-lg transition-colors'
              }, React.createElement('span', null, '⚙️'))
            )
          ),
          React.createElement('div', { className: 'flex-1 overflow-y-auto px-8 py-6' },
            React.createElement('div', { className: 'max-w-3xl mx-auto space-y-6' },
              messages.map((message, idx) => 
                React.createElement('div', { 
                  key: idx, 
                  className: `flex ${message.role === 'user' ? 'justify-end' : 'justify-start'}` 
                },
                  React.createElement('div', { 
                    className: `max-w-xl ${message.role === 'user' ? 'bg-gray-900 text-white' : 'bg-gray-50 text-gray-900'} rounded-2xl px-6 py-4` 
                  },
                    React.createElement('p', { className: 'text-sm leading-relaxed whitespace-pre-wrap' }, message.content),
                    message.metrics && React.createElement('pre', { 
                      className: 'mt-4 text-xs bg-white text-gray-800 rounded-lg p-3 overflow-x-auto' 
                    }, JSON.stringify(message.metrics, null, 2))
                  )
                )
              ),
              isLoading && React.createElement('div', { className: 'flex justify-start' },
                React.createElement('div', { className: 'bg-gray-50 rounded-2xl px-6 py-4' },
                  React.createElement('div', { className: 'flex space-x-2' },
                    React.createElement('span', { className: 'text-gray-500' }, '...')
                  )
                )
              ),
              React.createElement('div', { ref: messagesEndRef })
            )
          ),
          React.createElement('div', { className: 'border-t border-gray-100 px-8 py-6' },
            React.createElement('div', { className: 'max-w-3xl mx-auto' },
              React.createElement('div', { className: 'flex items-end space-x-4' },
                React.createElement('textarea', {
                  value: input,
                  onChange: (e) => setInput(e.target.value),
                  onKeyPress: handleKeyPress,
                  placeholder: 'Ask about campaign performance...',
                  className: 'flex-1 px-4 py-3 bg-gray-50 rounded-xl resize-none focus:outline-none focus:ring-2 focus:ring-gray-200',
                  rows: '1',
                  style: { minHeight: '48px' }
                }),
                React.createElement('button', {
                  onClick: handleSend,
                  disabled: isLoading || !input.trim(),
                  className: 'p-3 bg-gray-900 text-white rounded-xl hover:bg-gray-800 disabled:opacity-50'
                }, React.createElement('span', null, '➤'))
              ),
              React.createElement('div', { className: 'mt-3 text-xs text-gray-400' },
                'Try: "Give me a cross channel summary for October"'
              )
            )
          )
        ),
        showAgents && React.createElement('div', { className: 'w-96 border-l border-gray-100 bg-gray-50 p-6' },
          React.createElement('h2', { className: 'text-lg font-light mb-6' }, 'Agent Configuration'),
          Object.entries(agentPrompts).map(([agent, prompt]) =>
            React.createElement('div', { key: agent, className: 'mb-4 bg-white rounded-xl p-4' },
              React.createElement('button', {
                onClick: () => setActiveAgent(activeAgent === agent ? null : agent),
                className: 'w-full flex items-center justify-between mb-3 text-sm font-medium'
              }, agent, React.createElement('span', null, activeAgent === agent ? '▼' : '▶')),
              activeAgent === agent && React.createElement('textarea', {
                value: prompt,
                onChange: (e) => setAgentPrompts(prev => ({...prev, [agent]: e.target.value})),
                className: 'w-full h-24 p-2 text-xs bg-gray-50 rounded'
              })
            )
          )
        )
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(React.createElement(AdAgentOS));
  </script>
</body>
</html>
